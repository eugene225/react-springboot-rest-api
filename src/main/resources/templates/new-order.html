<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>카페 메뉴 주문</title>

    <!-- 부트스트랩 CSS 및 JavaScript 링크 추가 -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>
<div class="container">
    <h1 class="mt-5">카페 메뉴 주문</h1>

    <div class="row mt-4">
        <div class="col-md-6">
            <!-- 왼쪽 목록: 모든 주문 가능한 항목 -->
            <h2>주문 가능한 항목</h2>
            <div class="form-group">
                <label for="category">카테고리:</label>
                <select class="form-control" id="category">
                    <option value="all">전체</option>
                    <th:block th:each="category : ${categories}">
                        <option th:text="${category.name}" th:value="${category.name}">카테고리 이름</option>
                    </th:block>
                </select>
            </div>
            <table class="table">
                <thead>
                <tr>
                    <th>상품 이름</th>
                    <th>상품 가격</th>
                    <th>추가</th>
                </tr>
                </thead>
                <tbody>
                <th:block th:each="category : ${categories}">
                    <tr th:each="product : ${products}">
                        <td th:text="${product.productName}">상품 이름</td>
                        <td th:text="${product.price} + '원'">상품 가격</td>
                        <td>
                            <button class="btn btn-primary btn-sm" th:attr="onclick='addItem(\'' + product + '\')'">추가</button>
                        </td>
                    </tr>
                </th:block>
                </tbody>
            </table>
        </div>

        <!-- 오른쪽 목록: 선택한 항목 및 수량 조정 -->
        <div class="col-md-6">
            <form th:action="@{/create-order}" method="post">
                <h2>선택한 항목</h2>
                <table class="table">
                    <thead>
                    <tr>
                        <th>상품 이름</th>
                        <th>수량</th>
                        <th>삭제</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="selectedItem : ${selectedItems}">
                        <td th:text="${selectedItem.productName}">상품 이름</td>
                        <td>
                            <input type="number" name="quantity" th:value="${selectedItem.quantity}" min="1" th:onchange="updateTotalAmount()">
                        </td>
                        <td>
                            <button class="btn btn-danger btn-sm" th:attr="onclick='removeItem(this)'">삭제</button>
                        </td>
                    </tr>
                    </tbody>
                </table>

                <!-- 사용자 정보 입력 -->
                <div class="form-group mt-4">
                    <label for="email">이메일:</label>
                    <input type="email" class="form-control" name="email" id="email" required>
                </div>

                <div class="form-group">
                    <label for="address">주소:</label>
                    <input type="text" class="form-control" name="address" id="address" required>
                </div>

                <div class="form-group">
                    <label for="postcode">우편번호:</label>
                    <input type="text" class="form-control" name="postcode" id="postcode" required>
                </div>

                <div class="form-group">
                    <!-- 총 금액 표시 -->
                    <p>총 금액: <span id="total-amount">0</span> 원</p>
                </div>

                <div class="form-group">
                    <input type="submit" class="btn btn-primary" value="주문하기">
                </div>
            </form>
        </div>
    </div>
</div>

<script th:inline="javascript">
    /* 선택한 항목과 메뉴 가격을 JavaScript 변수로 가져옵니다. */
    var menuItems = /*[[${products}]]*/ [];
    var menuPrices = /*[[${menuPrices}]]*/ {};
    var selectedItems = /*[[${selectedItems}]]*/ [];

    function addItem(itemName) {
        var existingItem = selectedItems.find(item => item.productName === itemName);
        if (existingItem) {
            // 이미 선택한 항목인 경우 수량 증가
            existingItem.quantity++;
        } else {
            // 새로운 항목을 추가
            var price = menuPrices[itemName];
            var newItem = {
                productName: itemName,
                price: price,
                quantity: 1
            };
            selectedItems.push(newItem);
        }
        updateTotalAmount();
    }



    function removeItem(itemName) {
        var itemIndex = selectedItems.findIndex(item => item.productName === itemName);
        if (itemIndex !== -1) {
            selectedItems.splice(itemIndex, 1);
        }
        updateTotalAmount();
    }

    function updateTotalAmount() {
        let total = 0;
        selectedItems.forEach(item => {
            total += item.price * item.quantity;
        });
        totalAmount.textContent = total;
    }
</script>

<!-- 부트스트랩 및 jQuery 및 Popper.js 스크립트 추가 -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>
